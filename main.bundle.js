(()=>{"use strict";const e={element:document.querySelector("#game-board"),height:400,width:900},t={height:400,width:200,lives:null,elements:{container:document.getElementById("castle"),livesText:document.getElementById("castle-lives")},game:void 0,setup(e,t){this.game=e,this.lives=t,this.draw()},damage(e){this.lives-=e,this.draw(),0===this.lives&&this.game.gameOver()},draw(){this.elements.livesText.textContent=Math.max(0,this.lives)}},s=function(e,t,{autoRestart:s=!0}={}){let i=e;return Object.freeze({tick:function(n){i=Math.max(0,i-n),i<=1&&(t(),s&&(i=e))},getHumanTimeRemaining:function(){const e=Math.ceil(i/1e3)%60,t=Math.floor(Math.ceil(i/1e3)/60);return`${t<10?`0${t}`:t}:${e<10?`0${e}`:e}`}})},i={easy:["+","-"],medium:["+","-","×"],hard:["+","-","×"],insane:["+","-","×","÷"]},n=e=>Math.floor(Math.random()*e),a=e=>n((e=>{switch(e){case"easy":return 5;case"medium":return 10;case"hard":return 30;case"insane":return 100;default:return 5}})(e))+1,h=e=>{const t=(e=>i[e][(e=>n(i[e].length))(e)])(e);let s=a(e),h=a(e);for(;"÷"===t&&s%h!=0;)s=a(e),h=a(e);for(;"-"===t&&s-h<0;)s=a(e),h=a(e);for(;"×"===t&&s*h>150;)s=a(e),h=a(e);for(;"+"===t&&s+h>150;)s=a(e),h=a(e);const r=`${s} ${t} ${h}`;return{text:r,answer:(e=>{const t=e.split(" "),s=Number(t[0]),i=t[1],n=Number(t[2]);let a;return a="+"===i?s+n:"-"===i?s-n:"×"===i?s*n:s/n,a})(r)}},r={firstLane:50,secondLane:165,thirdLane:280};let m=40;const l=document.getElementById("start-page"),d=document.getElementById("game-page"),c=document.getElementById("game-over-page"),u=new class{constructor(){this.gameBoard=e,this.castle=t,this.answerForm=document.querySelector(".answer-form"),this.answerInput=document.querySelector("#answer-input"),this.gameTimer=document.querySelector("#game-timer"),this.fieldWidth=e.width-t.width,this.enemies=[],this.timers={},this.gameState=0,this.update=this.update.bind(this),this.draw=this.draw.bind(this),this.spawnEnemy=this.spawnEnemy.bind(this),this.handleAnswerSubmit=this.handleAnswerSubmit.bind(this),this.gameOver=this.gameOver.bind(this)}start(){this.castle.setup(this,3),this.answerForm.addEventListener("submit",this.handleAnswerSubmit),this.gameState=1,this.initialiseTimers(),l.style.display="none",c.style.display="none",d.style.display="flex"}update(e){1===this.gameState&&(Object.keys(this.timers).forEach((t=>this.timers[t].tick(e))),this.enemies.forEach((t=>t.update(this,e))))}draw(){this.gameTimer.textContent=this.timers.countDownTimer.getHumanTimeRemaining(),this.enemies.forEach((e=>e.draw()))}spawnEnemy(){const e=new class{constructor(e,t,s,i,n){this.elements={enemy:document.createElement("div"),question:document.createElement("div")},this.pos={x:e,y:t},this.width=50,this.height=50,this.speed=n,this.selected=!1,this.question=i,this.game=s,this.elements.enemy.classList.add("enemy"),this.elements.enemy.style.width=`${this.width}px`,this.elements.enemy.style.height=`${this.height}px`,this.elements.question.classList.add("enemy-question"),this.elements.question.textContent=this.question.text,this.elements.enemy.appendChild(this.elements.question),this.elements.enemy.addEventListener("click",(()=>{this.unSelect(),this.select(),this.game.answerInput.focus()}))}select(){this.selected=!0,this.selected&&this.elements.enemy.classList.add("selected")}unSelect(){const e=this.game.enemies.find((e=>e.selected));void 0!==e&&(e.selected=!1,e.elements.enemy.classList.remove("selected"))}update(e,t){if(this.hasHitCastle(e))return this.delete(e),void e.castle.damage(1);this.pos.x+=this.speed*(t/1e3)}draw(){this.elements.enemy.style.transform=`translate(${this.pos.x}px, ${this.pos.y}px)`}delete(){this.elements.enemy.remove(),this.game.deleteEnemy(this)}hasHitCastle(e){return this.pos.x>=e.fieldWidth-this.width}}(0,this.randomLane(),this,h("insane"),m);m+=3,this.gameBoard.element.appendChild(e.elements.enemy),this.enemies.push(e)}randomLane(){const e=Object.keys(r);return r[e[Math.floor(Math.random()*e.length)]]}deleteEnemy(e){this.enemies=this.enemies.filter((t=>t!==e))}gameOver(){this.gameState=2,d.style.display="none",c.style.display="flex",this.enemies.forEach((e=>{e.delete()})),this.answerInput.value="",m=40}initialiseTimers(){this.timers.spawnTimer=s(2500,this.spawnEnemy),this.timers.countDownTimer=s(3e5,this.gameOver,{autoRestart:!1})}handleAnswerSubmit(e){e.preventDefault();const t=this.enemies.find((e=>e.selected));if(!t)return;const s=t.question.answer.toString();this.answerInput.value===s&&t.delete(this),this.answerInput.value=""}},o=new class{constructor(e,t){this.running=!1,this.rafID=void 0,this.update=e,this.draw=t,this.accumulatedTime=0,this.currentTime=0,this.timeStep=1e3/60,this.cycle=this.cycle.bind(this)}cycle(e){this.rafID=requestAnimationFrame(this.cycle),this.accumulatedTime+=e-this.currentTime,this.currentTime=e;let t=!1;for(this.accumulatedTime>60&&(this.accumulatedTime=this.timeStep);this.accumulatedTime>=this.timeStep;)this.update(this.timeStep),t=!0,this.accumulatedTime-=this.timeStep;t&&this.draw()}start(){this.running=!0,this.rafID=requestAnimationFrame(this.cycle)}stop(){this.running=!1,cancelAnimationFrame(this.rafID)}}(u.update,u.draw),y=document.querySelector(".start-button"),p=document.querySelector(".restart-button");function g(){o.start(),u.start()}y.addEventListener("click",g),p.addEventListener("click",g)})();
//# sourceMappingURL=main.bundle.js.map